{{ if not .Values.global.oda.postgres.secret.existingSecret.name }}
{{- if .Values.global.oda.postgres.secret.vault.enabled }}
---
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: {{ template "ska-oso-services.oda-secret-name" $ }}
  namespace: {{ .Release.Namespace }}
spec:
  type: kv-v2
  mount: {{ $.Values.global.oda.postgres.secret.vault.mount }}
  path: {{ $.Values.global.oda.postgres.secret.vault.secretPath }}
  destination:
    name: {{ template "ska-oso-services.oda-secret-name" $ }}
    create: true
    overwrite: true
    excludeRaw: true
    includes:
    {{- range .Values.global.oda.postgres.secret.vault.secretKeys }}
      - {{ . }}
    {{- end }}
{{- else }}
apiVersion: v1
kind: Secret
metadata:
  name: {{ template "ska-oso-services.oda-secret-name" $ }}
  namespace: {{ .Release.Namespace }}
type: Opaque
stringData:
  # This list should match the keys that are in the secret in Vault (i.e. those in Values.postgres.password.vault.secretKeys)
  PGPASSWORD: localpassword
{{- end }}
{{- end }}